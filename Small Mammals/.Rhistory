stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- c(Genus_Colors, hue_pal(h = c(start, stop))(nGenera))
}
start <- stop+20
}
length(Genus_Colors)
na.omit(unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus']))
i=1
Genera <- na.omit(unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus']))
nGenera <- nrow(Genera)
nGenera
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
i
Genus_Colors <- cbind(Genera, hue_pal(h = c(start, stop))(nGenera))
Genus_Colors
for (i in 1:length(levels(mammals_filtered$Family))){
Genera <- na.omit(unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus']))
nGenera <- nrow(Genera)
if (nGenera != 0){
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- cbind(Genera, hue_pal(h = c(start, stop))(nGenera))
}
start <- stop+20
}
Genus_Colors
Genus_Colors <- NULL
start <- 0
stop <- 0
for (i in 1:length(levels(mammals_filtered$Family))){
Genera <- na.omit(unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus']))
nGenera <- nrow(Genera)
if (nGenera != 0){
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
}
start <- stop+20
}
Genus_Colors
colnames(Genus_Colors)[2] <- "color"
Genus_Colors
order(Genus_Colors$Genus)
Genus_Colors[order(Genus_Colors$Genus),]
bp<- ggplot(mammals_filtered,
aes(x="", y=n, fill=Genus_Colors[order(Genus_Colors$Genus),'color'])) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
dim(mammals_filtered)
i=1
mammals_filtered$Genus[i]
Genus_Colors <- rbind(Genus_Colors, c(NA, "gray"))
Genus_Colors <- rbind(Genus_Colors, data.frame(c(NA, "gray")))
data.frame(c(NA, "gray"))
Genus_Colors <- rbind(Genus_Colors, t(data.frame(c(NA, "gray"))))
Genus_Colors <- rbind(Genus_Colors, t(data.frame(c(NA, "gray"))), check.names=F)
?rbind
t(data.frame(c(NA, "gray")))
Genus_Colors
Genus_Colors <- rbind(Genus_Colors, t(data.frame(c(NA, #808080))), check.names=F)
Genus_Colors
mammals_filtered$Genus[i]
Genus_Colors <- NULL
start <- 0
stop <- 0
for (i in 1:length(levels(mammals_filtered$Family))){
Genera <- na.omit(unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus']))
nGenera <- nrow(Genera)
if (nGenera != 0){
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
}
start <- stop+20
}
colnames(Genus_Colors)[2] <- "color"
i=2
g <- mammals_filtered$Genus[i]
g
mammals_filtered$Genus
gColors[i] <- '#808080'
# match colors to Genus
gColors <- NULL
i=1
g <- mammals_filtered$Genus[i]
gColors[i] <- '#808080'
i=2
g <- mammals_filtered$Genus[i]
gColors[i] <- '#808080'
gColors
i=3
g <- mammals_filtered$Genus[i]
g
match(g, Genus_Colors$Genus)
Genus_Colors[match(g, Genus_Colors$Genus), 'color']
Genus_Colors[6,]
gColors <- NULL
for (i in 1:nrow(mammals_filtered)){
g <- mammals_filtered$Genus[i]
if (is.na(g)){
gColors[i] <- '#808080'
}else{
gColors[i] <- Genus_Colors[match(g, Genus_Colors$Genus), 'color']
}
}
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= gColors)) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
?scale_fill_manual
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=gColors) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
Genus_Colors
Genus_Colors <- rbind(Genus_Colors, c(NA, NA))
Genus_Colors
Genus_Colors[nrow(Genus_Colors), 'color'] <- '#808080'
Genus_Colors[nrow(Genus_Colors), 'color'] <- as.factor('#808080')
as.factor('#808080')
Genus_Colors$color <- as.character(Genus_Colors$color)
Genus_Colors[nrow(Genus_Colors), 'color'] <- '#808080'
Genus_Colors
Genus_Colors[order(Genus_Colors$Genus),]
Genus_Colors[order(Genus_Colors$Genus),'Genus'] == levels(mammals_filtered$Genus)
gColors <- Genus_Colors[order(Genus_Colors$Genus),'color']
gColors
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=gColors) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
match(levels(mammals_filtered$Genus), Genus_Colors[,'Genus'])
# reorder Genus levels to match taxonomy in Genus_Colors
factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[match(levels(mammals_filtered$Genus), Genus_Colors[,'Genus'])])
# reorder Genus levels to match taxonomy in Genus_Colors
factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[
match(Genus_Colors[,'Genus'], levels(mammals_filtered$Genus))])
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=Genus_Colors[,'color']) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
# reorder Genus levels to match taxonomy in Genus_Colors
factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[
match(Genus_Colors[,'Genus'], levels(mammals_filtered$Genus))])
# reorder Genus levels to match taxonomy in Genus_Colors
mammals_filtered$Genus <- factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[
match(Genus_Colors[,'Genus'], levels(mammals_filtered$Genus))])
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=Genus_Colors[,'color']) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
mammals_filtered <- mammals_trim %>%
filter(!is.na(Family)) %>%
filter(Order != "Carnivora") %>%
filter(Order != "Artiodactyla") %>%
filter(!is.na(Genus))
# read in master mammal data
mammals <- read.delim("data/processed/master_mammal_file.txt", sep="\t", stringsAsFactors = F)
taxonomy <- read.delim("data/raw/TaxonomyMatchingFile.txt", sep="\t", stringsAsFactors = F)
taxon <- as.data.frame(matrix(ncol=4, nrow=nrow(mammals)))
colnames(taxon) <- c('RevisedName', "Order", "Family", "Genus")
for (i in 1:nrow(taxon)){
taxon[i,] <- taxonomy[which(taxonomy$'OriginalName' == mammals$prelim_taxon_name[i]),c('RevisedName', "Order", "Family", "Genus")]
}
mammals_trim <- select(mammals, "prelim_taxon_name", "box")
mammals_trim <- cbind(mammals_trim, taxon)
mammals_trim$Family <- as.factor(mammals_trim$Family)
mammals_trim$Order <- as.factor(mammals_trim$Order)
mammals_trim$Genus <- as.factor(mammals_trim$Genus)
mammals_trim$box <- as.factor(mammals_trim$box)
mammals_filtered <- mammals_trim %>%
filter(!is.na(Family)) %>%
filter(Order != "Carnivora") %>%
filter(Order != "Artiodactyla") %>%
filter(!is.na(Genus))
mammals_filtered
mammals_filtered$Genus
mammals_filtered$Order <- droplevels(mammals_filtered$Order)
mammals_filtered$Family <- droplevels(mammals_filtered$Family)
mammals_filtered$Genus <- droplevels(mammals_filtered$Genus)
mammals_filtered
mammals_filtered$Genus
mammals_filtered <- mammals_filtered %>%
group_by(box, RevisedName, Family, Genus) %>%
summarise(n=n())
Genus_Colors <- NULL
start <- 0
stop <- 0
for (i in 1:length(levels(mammals_filtered$Family))){
Genera <- na.omit(unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus']))
nGenera <- nrow(Genera)
if (nGenera != 0){
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
}
start <- stop+20
}
colnames(Genus_Colors)[2] <- "color"
Genus_Colors
which(is.na(mammals_filtered$Genus))
# reorder Genus levels to match taxonomy in Genus_Colors
mammals_filtered$Genus <- factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[match(Genus_Colors[,'Genus'], levels(mammals_filtered$Genus))])
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=Genus_Colors[,'color']) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
v
levels(mammals_filtered$Family)
Genus_Colors <- NULL
start <- 0
stop <- 0
i=1
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
Genera
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
i=2
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
nGenera
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
i=3
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
i=4
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
i=5
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
length(levels(mammals_filtered$Family))
i=6
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
start
i=7
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start
stop
colnames(Genus_Colors)[2] <- "color"
Genus_Colors
# reorder Genus levels to match taxonomy in Genus_Colors
mammals_filtered$Genus <- factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[match(Genus_Colors[,'Genus'], levels(mammals_filtered$Genus))])
mammals_filtered$Genus
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=Genus_Colors[,'color']) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
Genus_Colors[,'color']
levels(Genus_Colors$color)
show_col(Genus_Colors$color)
i=1
Genus_Colors <- NULL
start <- 0
stop <- 0
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- NULL
start <- 0
stop <- 0
for (i in 1:length(levels(mammals_filtered$Family))){
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
}
colnames(Genus_Colors)[2] <- "color"
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=Genus_Colors[,'color']) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
Genus_Colors
show_col(Genus_Colors)
show_col(Genus_Colors$color)
show_col(Genus_Colors$color)
col2rgb(Genus_Colors$color, alpha = FALSE)
col2rgb(Genus_Colors$color, alpha = FALSE)[1,]
col2rgb(Genus_Colors$color, alpha = FALSE)[1,]/255
?rgb
col2rgb(Genus_Colors$color, alpha = FALSE)/255
show_col(rgb(col2rgb(Genus_Colors$color, alpha = FALSE)/255))
col2rgb(Genus_Colors$color, alpha = FALSE)/255
t(col2rgb(Genus_Colors$color, alpha = FALSE)/255)
show_col(rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255)))
Genus_Colors <- NULL
start <- 0
stop <- 0
for (i in 1:length(levels(mammals_filtered$Family))){
Genera <- unique(mammals_filtered[which(mammals_filtered$Family==levels(mammals_filtered$Family)[i]),'Genus'])
nGenera <- nrow(Genera)
if (nGenera <= 3){
stop <- start+20
}else{
stop <- start+50
}
show_col(hue_pal(h = c(start, stop))(nGenera))
Genus_Colors <- rbind(Genus_Colors, cbind(Genera, hue_pal(h = c(start, stop))(nGenera)))
start <- stop+20
}
colnames(Genus_Colors)[2] <- "color"
# reorder Genus levels to match taxonomy in Genus_Colors
mammals_filtered$Genus <- factor(mammals_filtered$Genus,levels(mammals_filtered$Genus)[match(Genus_Colors[,'Genus'], levels(mammals_filtered$Genus))])
show_col(rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255)))
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="none") +
facet_grid(. ~ box) +
theme_light()
bp
?legend.position
?theme
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
theme(legend.position="bottom") +
facet_grid(. ~ box) +
theme_light()
bp
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
# theme(legend.position="bottom") +
facet_grid(. ~ box) +
theme_light()
bp
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
#geom_text(aes(label = n), size=1, position = position_fill(vjust = 0.5)) +
coord_polar("y", start=0) +
# theme(legend.position="bottom") +
facet_grid(. ~ box) +
theme_light()
bp
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
coord_polar("y", start=0) +
facet_wrap(. ~ box) +
theme_light()
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
coord_polar("y", start=0) +
facet_wrap(~ box) +
theme_light()
bp
bp<- ggplot(mammals_filtered, aes(x="", y=n, fill= Genus)) +
scale_fill_manual(values=rgb(t(col2rgb(Genus_Colors$color, alpha = FALSE)/255))) +
geom_bar(stat = "identity", position = position_fill()) +
coord_polar("y", start=0) +
facet_grid(.~ box) +
theme_light()
bp
pdf(file="output/mammal_nisp.pdf", width=15, height=7.5, encoding="MacRoman")
bp
dev.off()
levels(mammals_filtered$Family)
levels(mammals_filtered$Order)
levels(mammals$Order)
levels(mammals_trim$Order)
